---
title: 进程与线程
description: 计算机基础
mathjax: true
tags:
  - 计算机基础
categories:
  - 计算机基础
abbrlink: eefe591f
date: 2024-07-10 19:18:02
updated: 2024-07-23 22:00:00
---
# 进程与线程
**进程**是一个具有一定独立功能的程序在一个数据集合上的一次动态执行过程。它是资源分配的基本单位和调度的基本单位。操作系统通过进程来管理CPU、内存、I/O设备等资源。通俗的说，我们编写的代码只是一个存储在硬盘的静态文件，通过编译后就会生成二进制可执行文件，当我们运行这个可执行文件后，它会被装载到内存中，接着 CPU 会执行程序中的每一条指令，那么这个**运行中的程序（包括它打开的所有文件以及持有的所有资源等），就被称为「进程」（Process）**。
**线程** 也被称为轻量级进程，更加轻量。多个线程可以在同一个进程中同时执行，并且共享进程的资源比如内存空间、文件句柄、网络连接等。
## 进程状态模型
图源[小林coding](https://xiaolincoding.com/)
<img src="/post-img/Pasted image 20240730152402.png" alt="图片损坏" style="zoom:100%;" />

## PCB（process control block）
PCB (Process Control Block) 是操作系统中用于管理进程的重要数据结构。每个进程都有一个唯一的 PCB，它存储了进程的相关信息，用于操作系统对进程的管理和调度。PCB是进程在操作系统中存在的唯一证明。PCB之间以链表的形式互相组织，组成了阻塞队列、就绪队列等。
PCB中存储如下信息：
1. **进程描述信息**：进程标识符PID，用户标识符UID
2. **进程当前状态**：new、ready、running、waiting、blocked
3. **进程优先级**：决定进程抢占 CPU 的顺序。优先级高的进程在调度时会优先获取 CPU 时间片
4. **资源分配清单**：有关内存地址空间或虚拟地址空间的信息，所打开文件的列表和所使用的 I/O 设备信息。
5. **CPU 相关信息**：CPU 中各个寄存器的值，当进程被切换时，CPU 的状态信息都会被保存在相应的 PCB 中，以便进程重新执行时，能从断点处继续执行。

# 补充
## go协程
**Go 协程（Goroutine）** 是 Go 语言中的并发执行单元。它们是轻量级的线程，由 Go 运行时管理，而不是操作系统。Go 协程通过 `go` 关键字创建，具有以下特点：
1. **轻量级**：初始栈大小仅为 2KB，栈可以动态扩展和收缩。
2. **高效创建和销毁**：创建和销毁的开销非常低，可以在一个程序中创建成千上万个协程。
3. **用户态调度**：由 Go 运行时调度器管理，不依赖操作系统内核调度。
4. **抢占式调度**：确保长时间运行的协程不会阻塞其他协程。
5. **工作窃取**：用于均衡负载，提高并发性能。
## java线程
java中的线程有一些自己定义的状态，但基本上对应于操作系统线程。java中的线程运行时通过操作系统调度，这使它相对go协程来说有以下特点：
- **重量级**：线程的栈大小固定，通常为 1MB 或更多，因此创建大量线程会消耗大量内存。
- **启动较慢**：创建线程的开销较大，因为涉及到与操作系统内核的交互。
- **操作系统调度**：线程由操作系统调度器管理，调度粒度较大，可能导致上下文切换开销较高。
- **资源共享**：同一进程中的线程共享内存地址空间和文件描述符等资源，易于实现线程间通信，但需要显式同步（如使用锁）来防止竞态条件。
## 对比java线程/go协程/操作系统线程
Go 协程、Java 线程和操作系统线程在**管理方式、创建开销、栈管理、调度机制以及适用场景**等方面存在显著差异。
**Go 协程**是由 Go 语言的运行时调度器管理的轻量级并发执行单元。与传统的操作系统线程不同，Go 协程的创建和销毁开销极低。它们的初始栈非常小（仅 2KB），并且能够根据需要动态扩展和收缩，极大地节省了内存资源。Go 运行时调度器在用户态进行调度，采用抢占式调度和工作窃取算法，这使得 Go 协程能够高效地管理大量并发任务。由于这些特点，Go 协程特别适用于高并发和高并行的应用场景，例如 Web 服务器和微服务架构。
**Java 线程**依赖于操作系统的线程调度机制进行管理。每个 Java 线程在底层对应一个操作系统线程，因此创建和销毁 Java 线程的开销较高，因为涉及到操作系统内核的交互。Java 线程的栈大小通常是固定的，一般为 1MB 或更多，这在某些情况下会导致较高的内存消耗。由于 Java 线程是由操作系统进行调度，调度机制的开销相对较大，适合需要复杂资源管理的应用场景，例如桌面应用程序、多媒体处理和中大型服务器应用。
**操作系统线程**完全由操作系统内核进行调度和管理。创建和销毁操作系统线程的开销较高，因为涉及到内核态和用户态之间的切换。操作系统线程的栈大小通常较大且固定，进一步增加了资源消耗。尽管调度机制的开销较大，但操作系统线程能够直接与硬件交互，并支持高可靠性和实时性的任务，因此非常适用于底层系统服务、驱动程序和操作系统内核模块等场景。